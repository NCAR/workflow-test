# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. Triggers the workflow on push or pull request
# events but only for the main branch
on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2

      # Runs a set of commands using the runners shell
      - name: Run a multi-line script
        run: |
          gfortran -g pi.f -o pi
          ./pi
          
      # install open mpi
      - name: download-openmpi
        run: wget https://download.open-mpi.org/release/open-mpi/v4.0/openmpi-4.0.2.tar.gz
      - name: extract-openmpi
        run: tar -xvf ./openmpi-4.0.2.tar.gz
      - name: configure-openmpi
        run: ./openmpi-4.0.2/configure --prefix="/home/${USER}/.openmpi"
      - name: install-openmpi
        run: |
          make -j
          sudo make install
          
      # mpi to the max
      - name: mpi to the max
        run: mpif90 --version
        
